<html>
  <head>
    <title>WE R BLOK</title>
    <style type="text/css">
      #piece {
        font-size: 400%;
        height: 2em;
        line-height: 2em;
        width: 2em;
        text-align: center;
        border: 1px solid teal;
        border-radius: 0.5em;
        margin: 1em;
        box-shadow: 0 0 0.5em 0 teal;
        cursor: pointer;

        /* so that multiple clicks don't select the text */
        -webkit-touch-callout: none;
        -webkit-user-select: none;

        -webkit-transition-property: -webkit-transform;
        -webkit-transition-duration: 0.5s;
      }


    </style>
  </head>
  <body>

    <h1>BLOK</h1>

    <p>Wherein I make a block that can spin, flip and drag.</p>
    <p>click to rotate, hold to flip.</p>

    <div id="piece">&#24038;</div>

    <script type="text/javascript">

      (function(d){
      
        var p = d.getElementById("piece"),
            s, spin=0, doSpin,
            flipped=false, doFlip,
            flipThres = 400;

        window.onmousedown = function(e){
          if (e.target === p){
            s = new Date().getTime();
          }
        };
        window.ontouchstart = window.onmousedown;

        window.onmouseup   = function(e){
          if (e.target === p){
            var dur = new Date().getTime() - s;

            if (dur > flipThres){
                doFlip();
            } else {
                doSpin();
            }
          }           
        };
        window.ontouchend = window.onmouseup;

        doSpin = function(){
          spin = spin + (flipped ? -1 : 1);
          setClass();
        }

        doFlip = function(){
          flipped = !flipped;
          setClass();
        }

        setClass = function(){
          var style = "scaleX("+ (flipped?-1:1) +") rotate("+ (spin*90) +"deg)";
          console.log("new style: " + style);
          p.style.webkitTransform = style;
        }

      }(document));

    </script>
  </body>
</html>
